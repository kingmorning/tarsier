webpackJsonp([1],{"./src/collect/CreateHost.jsx":function(e,t,a){"use strict";function l(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=(a("./node_modules/antd/lib/row/style/index.js"),a("./node_modules/antd/lib/row/index.js")),d=l(n),s=(a("./node_modules/antd/lib/input/style/index.js"),a("./node_modules/antd/lib/input/index.js")),o=l(s),r=(a("./node_modules/antd/lib/col/style/index.js"),a("./node_modules/antd/lib/col/index.js")),i=l(r),u=(a("./node_modules/antd/lib/modal/style/index.js"),a("./node_modules/antd/lib/modal/index.js")),c=l(u),m=(a("./node_modules/antd/lib/button/style/index.js"),a("./node_modules/antd/lib/button/index.js")),f=l(m),p=a("./node_modules/babel-runtime/helpers/classCallCheck.js"),h=l(p),b=a("./node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),g=l(b),E=a("./node_modules/babel-runtime/helpers/inherits.js"),x=l(E),y=(a("./node_modules/antd/lib/select/style/index.js"),a("./node_modules/antd/lib/select/index.js")),j=l(y),v=(a("./node_modules/antd/lib/form/style/index.js"),a("./node_modules/antd/lib/form/index.js")),_=l(v),C=a("./node_modules/react/react.js"),S=l(C),k=a("./node_modules/react-dom/index.js"),N=(l(k),a("./node_modules/query-string/index.js")),D=l(N),L=a("./src/components/ajax/index.js"),I=l(L),G=_.default.Item,M=j.default.Option,q=function(e){function t(a){(0,h.default)(this,t);var l=(0,g.default)(this,e.call(this,a));return l.handleModalOk=function(){var e=l.form;e.validateFields(function(t,a){t||(l.setState({confirmLoading:!0}),I.default.post("/tarsier-manager/collect/save",{body:{userName:D.default.parse(location.search).userName,ip:a.ip,name:a.name,type:a.type,group:"0"===a.groupNameSlt?a.groupNameIpt:a.groupNameSlt}}).then(function(t){e.resetFields(),l.setState({modalVisible:!1,confirmLoading:!1}),t.item.key=t.item.id,l.props.onCreated(t.item)}).catch(function(e){l.setState({confirmLoading:!1})}))})},l.handleModalCancel=function(){l.setState({modalVisible:!1})},l.handleBtnCreate=function(){l.setState({modalVisible:!0})},l.saveFormRef=function(e){l.form=e},l.state={modalVisible:!1,confirmLoading:!1},l}return(0,x.default)(t,e),t.prototype.render=function(){return S.default.createElement("div",null,S.default.createElement(f.default,{size:"large",icon:"plus",onClick:this.handleBtnCreate},"新建主机"),S.default.createElement(c.default,{title:"新建主机",visible:this.state.modalVisible,confirmLoading:this.state.confirmLoading,onOk:this.handleModalOk,onCancel:this.handleModalCancel},S.default.createElement(R,{ref:this.saveFormRef,groups:this.props.groups})))},t}(S.default.Component);t.default=q;var P=function(e){function t(){(0,h.default)(this,t);var a=(0,g.default)(this,e.call(this));return a.handleGroupChange=function(e){a.setState({customGroup:0==e})},a.state={customGroup:!1},a}return(0,x.default)(t,e),t.prototype.render=function(){var e=this.props.form.getFieldDecorator;return S.default.createElement(_.default,{className:"create-host-form"},S.default.createElement(d.default,{gutter:10},S.default.createElement(i.default,{span:this.state.customGroup?12:24},S.default.createElement(G,{className:"form-item",label:"群组"},e("groupNameSlt",{rules:[{required:!0,message:"请选择群组"}],onChange:this.handleGroupChange})(S.default.createElement(j.default,{placeholder:"请选择群组"},S.default.createElement(M,{value:"0"},"自定义群组"),this.props.groups.map(function(e){return S.default.createElement(M,{key:e,value:e},e)}))))),this.state.customGroup&&S.default.createElement(i.default,{span:12},S.default.createElement(G,{className:"form-item",label:"群组名称"},e("groupNameIpt",{rules:[{required:!0,message:"请输入群组名称"}]})(S.default.createElement(o.default,{type:"text",placeholder:"请输入群组名称"}))))),S.default.createElement(G,{className:"form-item",label:"名称"},e("name",{rules:[{required:!0,message:"请输入名称"}]})(S.default.createElement(o.default,{type:"text",placeholder:"请输入名称"}))),S.default.createElement(G,{className:"form-item",label:"类型"},e("type",{rules:[{required:!0,message:"请选择类型"}]})(S.default.createElement(j.default,{placeholder:"请选择类型"},S.default.createElement(M,{value:"logstash"},"logstash"),S.default.createElement(M,{value:"filebeat"},"filebeat"),S.default.createElement(M,{value:"metricbeat"},"metricbeat"),S.default.createElement(M,{value:"packetbeat"},"packetbeat"),S.default.createElement(M,{value:"heartbeat"},"heartbeat")))),S.default.createElement(G,{className:"form-item",label:"IP"},e("ip",{rules:[{required:!0,message:"请输入IP地址"}]})(S.default.createElement(o.default,{type:"text",placeholder:"请输入IP地址"}))),S.default.createElement(G,{className:"form-item",label:"收集器配置"},S.default.createElement(o.default,{type:"textarea",disabled:!0,placeholder:"使用系统默认配置。如需修改，请创建后再修改配置。"})))},t}(S.default.Component),R=_.default.create()(P);e.exports=t.default},"./src/collect/UpdateHost.jsx":function(e,t,a){"use strict";function l(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=(a("./node_modules/antd/lib/row/style/index.js"),a("./node_modules/antd/lib/row/index.js")),d=l(n),s=(a("./node_modules/antd/lib/input/style/index.js"),a("./node_modules/antd/lib/input/index.js")),o=l(s),r=(a("./node_modules/antd/lib/col/style/index.js"),a("./node_modules/antd/lib/col/index.js")),i=l(r),u=(a("./node_modules/antd/lib/button/style/index.js"),a("./node_modules/antd/lib/button/index.js")),c=l(u),m=(a("./node_modules/antd/lib/modal/style/index.js"),a("./node_modules/antd/lib/modal/index.js")),f=l(m),p=a("./node_modules/babel-runtime/helpers/extends.js"),h=l(p),b=a("./node_modules/babel-runtime/helpers/classCallCheck.js"),g=l(b),E=a("./node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),x=l(E),y=a("./node_modules/babel-runtime/helpers/inherits.js"),j=l(y),v=(a("./node_modules/antd/lib/select/style/index.js"),a("./node_modules/antd/lib/select/index.js")),_=l(v),C=(a("./node_modules/antd/lib/form/style/index.js"),a("./node_modules/antd/lib/form/index.js")),S=l(C),k=a("./node_modules/react/react.js"),N=l(k),D=a("./node_modules/react-dom/index.js"),L=(l(D),a("./node_modules/query-string/index.js")),I=l(L),G=a("./node_modules/prop-types/index.js"),M=a("./src/components/ajax/index.js"),q=l(M),P=S.default.Item,R=_.default.Option,V=function(e){function t(a){(0,g.default)(this,t);var l=(0,x.default)(this,e.call(this,a));return l.handleModalOk=function(){l.form.validateFields(function(e,t){e||(l.setState({confirmLoading:!0}),q.default.post("/tarsier-manager/collect/save",{body:{id:l.props.data.id,userName:I.default.parse(location.search).userName,group:"0"===t.groupNameSlt?t.groupNameIpt:t.groupNameSlt,name:t.name,type:l.props.data.type,config:t.config}}).then(function(e){l.setState({modalVisible:!1,confirmLoading:!1}),e.item.key=e.item.id,l.props.onUpdated((0,h.default)({},e.item))}).catch(function(e){l.setState({confirmLoading:!1})}))})},l.handleModalCheck=function(){l.form.validateFields(function(e,t){e||(l.setState({confirmDisabled:!0,checkLoading:!0}),q.default.post("/tarsier-manager/collect/check",{body:{id:l.props.data.id,config:t.config}}).then(function(e){e.success&&f.default.success({title:"成功",content:"配置信息校验通过"}),l.setState({confirmDisabled:!1,checkLoading:!1})}).catch(function(e){l.setState({confirmDisabled:!1,checkLoading:!1})}))})},l.handleModalCancel=function(){l.setState({modalVisible:!1})},l.handleBtnUpdate=function(){l.setState({modalVisible:!0})},l.saveFormRef=function(e){l.form=e},l.state={modalVisible:!1,confirmLoading:!1,confirmDisabled:!1,checkLoading:!1},l}return(0,j.default)(t,e),t.prototype.render=function(){return N.default.createElement("span",null,N.default.createElement("a",{href:"#",onClick:this.handleBtnUpdate},"编辑"),N.default.createElement(f.default,{title:"编辑配置",visible:this.state.modalVisible,width:600,confirmLoading:this.state.confirmLoading,style:{top:20},onOk:this.handleModalOk,onCancel:this.handleModalCancel,footer:[N.default.createElement(c.default,{key:"back",size:"large",onClick:this.handleModalCancel},"取消"),N.default.createElement(c.default,{key:"check",size:"large",loading:this.state.checkLoading,onClick:this.handleModalCheck},"校验"),N.default.createElement(c.default,{key:"submit",type:"primary",size:"large",loading:this.state.confirmLoading,disabled:this.state.confirmDisabled,onClick:this.handleModalOk},"保存")]},N.default.createElement(O,(0,h.default)({},this.props,{ref:this.saveFormRef}))))},t}(N.default.Component);V.propTypes={data:G.object.isRequired,groups:G.array.isRequired,onUpdated:G.func.isRequired},t.default=V;var F=function(e){function t(){(0,g.default)(this,t);var a=(0,x.default)(this,e.call(this));return a.handleGroupChange=function(e){a.setState({customGroup:0==e})},a.state={customGroup:!1},a}return(0,j.default)(t,e),t.prototype.render=function(){var e=this.props.form.getFieldDecorator;return N.default.createElement("div",null,N.default.createElement(S.default,{className:"update-host-form"},N.default.createElement(d.default,{gutter:10},N.default.createElement(i.default,{span:this.state.customGroup?12:24},N.default.createElement(P,{className:"form-item",label:"群组"},e("groupNameSlt",{rules:[{required:!0,message:"请选择群组"}],onChange:this.handleGroupChange,initialValue:this.props.data.group})(N.default.createElement(_.default,{placeholder:"请选择群组"},N.default.createElement(R,{value:"0"},"自定义群组"),this.props.groups.map(function(e){return N.default.createElement(R,{key:e,value:e},e)}))))),this.state.customGroup&&N.default.createElement(i.default,{span:12},N.default.createElement(P,{className:"form-item",label:"群组名称"},e("groupNameIpt",{rules:[{required:!0,message:"请输入群组名称"}]})(N.default.createElement(o.default,{type:"text",placeholder:"请输入群组名称"}))))),N.default.createElement(P,{className:"form-item",label:"名称"},e("name",{rules:[{required:!0,message:"请输入名称"}],initialValue:this.props.data.name})(N.default.createElement(o.default,{type:"text",placeholder:"请输入名称"}))),N.default.createElement(d.default,{gutter:10},N.default.createElement(i.default,{span:12},N.default.createElement(P,{className:"form-item",label:"类型"},N.default.createElement(o.default,{type:"text",disabled:!0,value:this.props.data.type}))),N.default.createElement(i.default,{span:12},N.default.createElement(P,{className:"form-item",label:"IP"},N.default.createElement(o.default,{type:"text",disabled:!0,value:this.props.data.ip})))),N.default.createElement(P,{className:"form-item",label:"收集器配置"},e("config",{rules:[{required:!0,message:"请输入配置"}],initialValue:this.props.data.config})(N.default.createElement(o.default,{type:"textarea",autosize:{minRows:2,maxRows:15}})))))},t}(N.default.Component),O=S.default.create()(F);e.exports=t.default},"./src/collect/index.jsx":function(e,t,a){"use strict";function l(e){return e&&e.__esModule?e:{default:e}}var n=(a("./node_modules/antd/lib/table/style/index.js"),a("./node_modules/antd/lib/table/index.js")),d=l(n),s=(a("./node_modules/antd/lib/button/style/index.js"),a("./node_modules/antd/lib/button/index.js")),o=l(s),r=(a("./node_modules/antd/lib/input/style/index.js"),a("./node_modules/antd/lib/input/index.js")),i=l(r),u=(a("./node_modules/antd/lib/modal/style/index.js"),a("./node_modules/antd/lib/modal/index.js")),c=l(u),m=(a("./node_modules/antd/lib/popconfirm/style/index.js"),a("./node_modules/antd/lib/popconfirm/index.js")),f=l(m),p=(a("./node_modules/antd/lib/popover/style/index.js"),a("./node_modules/antd/lib/popover/index.js")),h=l(p),b=a("./node_modules/babel-runtime/helpers/extends.js"),g=l(b),E=a("./node_modules/babel-runtime/helpers/toConsumableArray.js"),x=l(E),y=a("./node_modules/babel-runtime/helpers/classCallCheck.js"),j=l(y),v=a("./node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),_=l(v),C=a("./node_modules/babel-runtime/helpers/inherits.js"),S=l(C),k=(a("./node_modules/antd/lib/select/style/index.js"),a("./node_modules/antd/lib/select/index.js")),N=l(k),D=(a("./node_modules/antd/lib/form/style/index.js"),a("./node_modules/antd/lib/form/index.js")),L=l(D);a("./src/collect/index.less");var I=a("./node_modules/react/react.js"),G=l(I),M=a("./node_modules/react-dom/index.js"),q=l(M),P=a("./node_modules/query-string/index.js"),R=l(P);a("./src/components/iconfont/index.js");var V=a("./src/components/ajax/index.js"),F=l(V),O=a("./src/collect/CreateHost.jsx"),U=l(O),w=a("./src/collect/UpdateHost.jsx"),T=l(w),H=L.default.Item,z=N.default.Option,B=function(e){function t(){(0,j.default)(this,t);var a=(0,_.default)(this,e.call(this));return a.handleHostCreated=function(e){a.storedData=[e].concat(a.state.tableData);var t=[].concat((0,x.default)(a.state.groups));t.includes(e.group)||t.push(e.group),a.setState({tableData:[].concat((0,x.default)(a.storedData)),groups:t})},a.handleHostUpdated=function(e){a.storedData.forEach(function(t){t.id===e.id&&(t.name=e.name,t.group=e.group,t.config=e.config)});var t=[].concat((0,x.default)(a.state.groups));t.includes(e.group)||t.push(e.group),a.setState({tableData:[].concat((0,x.default)(a.storedData)),groups:t})},a.handleGroupChange=function(e){"0"===e&&(e=""),a.setState({filter:(0,g.default)({},a.state.filter,{group:e})},a.doSearch)},a.handleNameChange=function(e){a.setState({filter:(0,g.default)({},a.state.filter,{name:e.target.value})},a.doSearch)},a.handleTypeChange=function(e){"0"===e&&(e=""),a.setState({filter:(0,g.default)({},a.state.filter,{type:e})},a.doSearch)},a.handleIpChange=function(e){a.setState({filter:(0,g.default)({},a.state.filter,{ip:e.target.value})},a.doSearch)},a.handleBtnRefresh=function(){a.getDataList()},a.handleTableDelete=function(e){var t=[].concat((0,x.default)(a.state.tableData));a.setState({tableLoading:!0}),F.default.post("/tarsier-manager/collect/delete?id="+e).then(function(l){var n=t.findIndex(function(t){return t.id===e});t.splice(n,1),a.setState({tableData:t,tableLoading:!1}),n=a.storedData.findIndex(function(t){return t.id===e}),a.storedData.splice(n,1),a.getGroups()}).catch(function(e){a.setState({tableLoading:!1})})},a.handleTableEnable=function(e,t){var l=[].concat((0,x.default)(a.state.tableData));a.setState({tableLoading:!0}),F.default.post("/tarsier-manager/collect/"+(t?"enable":"disable")+"?id="+e).then(function(t){var n=l.find(function(t){return t.id===e});n.disabled=t.item.disabled,n.status=t.item.status,a.setState({tableData:l,tableLoading:!1})}).catch(function(e){a.setState({tableLoading:!1})})},a.handlePageChange=function(e){a.setState({currentPage:e})},a.storedData=[],a.state={tableColumns:[{dataIndex:"id",title:"ID"},{dataIndex:"group",title:"群组"},{dataIndex:"name",title:"名称"},{dataIndex:"type",title:"类型"},{dataIndex:"ip",title:"IP"},{dataIndex:"status",title:"状态"},{title:"描述信息",render:function(e,t){return G.default.createElement(h.default,{overlayClassName:"popover-desc",content:t.description||"无"},t.desc)}},{title:"检查时间",render:function(e,t){return t.checkTime||"无"}},{title:"操作",render:function(e,t,l){return G.default.createElement("span",null,G.default.createElement(T.default,{data:t,groups:a.state.groups,onUpdated:a.handleHostUpdated}),G.default.createElement("span",{className:"ant-divider"}),t.disabled?G.default.createElement(f.default,{title:"确认启用吗?",onConfirm:function(){return a.handleTableEnable(t.id,!0)}},G.default.createElement("a",{href:"#"},"启用")):G.default.createElement(f.default,{title:"确认禁用吗?",onConfirm:function(){return a.handleTableEnable(t.id,!1)}},G.default.createElement("a",{href:"#"},"禁用")),G.default.createElement("span",{className:"ant-divider"}),G.default.createElement(f.default,{title:"确认删除吗?",onConfirm:function(){return a.handleTableDelete(t.id)}},G.default.createElement("a",{href:"#"},"删除")))}}],tableData:[],tableLoading:!0,modalVisible:!1,groups:[],customGroup:!0,currentPage:1,filter:{name:"",ip:"",group:"",type:""}},a}return(0,S.default)(t,e),t.prototype.componentDidMount=function(){if(!this.checkUserName())return void c.default.error({title:"发生错误",content:"无法获取用户信息"});this.getDataList(),this.getGroups(),this.initFilter()},t.prototype.checkUserName=function(){return!!R.default.parse(location.search).userName},t.prototype.getDataList=function(){var e=this;this.setState({tableLoading:!0});var t=R.default.parse(location.search);F.default.get("/tarsier-manager/collect/list",{params:{userName:t.userName}}).then(function(t){t.items||(t.items=[]),e.storedData=t.items,e.setState({tableData:t.items.map(function(e){return e.key=e.id,e}),tableLoading:!1},e.doSearch)}).catch(function(t){e.setState({tableLoading:!1})})},t.prototype.getGroups=function(){var e=this;F.default.get("/tarsier-manager/collect/group",{params:{userName:R.default.parse(location.search).userName}}).then(function(t){e.setState({groups:t.items})})},t.prototype.initFilter=function(){var e=R.default.parse(location.search);this.setState({filter:{group:e.group,name:e.name,type:e.type,ip:e.ip}})},t.prototype.doSearch=function(){var e=this,t=[].concat((0,x.default)(this.storedData));this.state.filter.group&&(t=t.filter(function(t){return t.group===e.state.filter.group})),this.state.filter.name&&(t=t.filter(function(t){return t.name.includes(e.state.filter.name)})),this.state.filter.type&&(t=t.filter(function(t){return t.type.includes(e.state.filter.type)})),this.state.filter.ip&&(t=t.filter(function(t){return t.ip.includes(e.state.filter.ip)})),this.setState({currentPage:1,tableData:t})},t.prototype.render=function(){return G.default.createElement("div",{className:"page-collect"},G.default.createElement("h2",null,"收集器列表"),G.default.createElement("div",{className:"btn-group"},G.default.createElement(L.default,{layout:"inline",onSubmit:this.handleSubmit},G.default.createElement(H,{label:"群组"},G.default.createElement(N.default,{value:this.state.filter.group||"0",style:{width:"150px"},onChange:this.handleGroupChange},G.default.createElement(z,{value:"0"},"请选择群组"),this.state.groups.map(function(e){return G.default.createElement(z,{key:e,value:e},e)}))),G.default.createElement(H,{label:"名称"},G.default.createElement(i.default,{placeholder:"支持模糊匹配",value:this.state.filter.name,onChange:this.handleNameChange})),G.default.createElement(H,{label:"类型"},G.default.createElement(N.default,{value:this.state.filter.type||"0",style:{width:"150px"},onChange:this.handleTypeChange},G.default.createElement(z,{value:"0"},"请选择类型"),G.default.createElement(z,{value:"logstash"},"logstash"),G.default.createElement(z,{value:"filebeat"},"filebeat"),G.default.createElement(z,{value:"metricbeat"},"metricbeat"),G.default.createElement(z,{value:"packetbeat"},"packetbeat"),G.default.createElement(z,{value:"heartbeat"},"heartbeat"))),G.default.createElement(H,{label:"IP"},G.default.createElement(i.default,{placeholder:"支持模糊匹配",value:this.state.filter.ip,onChange:this.handleIpChange})),G.default.createElement(H,null,G.default.createElement(o.default,{icon:"reload",onClick:this.handleBtnRefresh},"刷新")),G.default.createElement(H,null,G.default.createElement(U.default,{groups:this.state.groups,onCreated:this.handleHostCreated})))),G.default.createElement("div",{className:"data-table"},G.default.createElement(d.default,{loading:this.state.tableLoading,columns:this.state.tableColumns,size:"middle",dataSource:this.state.tableData,pagination:{pageSize:20,current:this.state.currentPage,onChange:this.handlePageChange}})))},t}(G.default.Component);q.default.render(G.default.createElement(B,null),document.getElementById("root"))},"./src/collect/index.less":function(e,t){}},["./src/collect/index.jsx"]);